<!DOCTYPE html>
<html>

<head>
  <title>Labor</title>
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
  <meta charset="utf-8">
  <style>
      html, body {
         height: 100%;
         margin: 0;
         padding: 0;
      }

      #column {
         width: 20%;
         height: 100%;
      }
      
      #map {
         height: 100%;
         width: 80%;
         background-color: grey;
         float: right;
      }

      input {
         padding-top: 40vh;
         box-sizing: border-box; 
         width: 20%;
         float: left;
         outline: solid black 4px;
      }

  </style>
</head>

<body>
   
   <input type = "text" name ="Full Name" placeholder="enter zip">
   <div id="map"></div>
   
   
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
   <script>
      async function initMap() {
         // Create the map.
         map = new google.maps.Map(document.getElementById('map'), {
            zoom: 8,
            center: {lat: 42.360, lng: -71.0589},
         });

         const apiKey = 'AIzaSyBC9qoUkWr5lhVeqb8agYWE7Gx5zxTT66c';
         const infoWindow = new google.maps.InfoWindow();

         bounds = new google.maps.LatLngBounds();

         // Try HTML5 geolocation
         if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(position => {
               pos = {
               lat: position.coords.latitude,
               lng: position.coords.longitude
               };
               map.setCenter(pos);
               map.setZoom(10);
               bounds.extend(pos);

               infoWindow.setPosition(pos);
               infoWindow.setContent('Location found.');
               infoWindow.open(map);
               map.setCenter(pos);

            }, () => {
               // add window that points to zip entry
            });
         }

         // Load the stores GeoJSON onto the map.
         $.getJSON("https://jcurrrrr.github.io/stores.json", function(json) {
            // var center = getLatLngByZipcode('02138');
            var center = new google.maps.LatLng(42.3803, -71.1389)
            
            addPoints(map, infoWindow, json, center, 10000);
         });
         
         /*
         // Show the information for a store when its marker is clicked.
         map.data.addListener('click', (event) => {
            const category = event.feature.getProperty('category');
            const name = event.feature.getProperty('name');
            const description = event.feature.getProperty('description');
            const hours = event.feature.getProperty('hours');
            const phone = event.feature.getProperty('phone');
            const position = event.feature.getGeometry().get();
            const content = `
               <h2>${name}</h2><p>${description}</p>
               <p><b>Open:</b> ${hours}<br/><b>Phone:</b> ${phone}</p>
            `;

            infoWindow.setContent(content);
            infoWindow.setPosition(position);
            infoWindow.setOptions({pixelOffset: new google.maps.Size(0, -30)});
            infoWindow.open(map);
         });
         */
      }
      
      function addPoints(map, infowindow, json, center, radius) {
         var i;
         for (i = 0; i < json.features.length; i++) {
            
            currEntry = json.features[i].properties;
            latlng = new google.maps.LatLng(currEntry.coordinates[1], currEntry.coordinates[0]);
            dist = google.maps.geometry.spherical.computeDistanceBetween(center, latlng);
            if (dist < radius) {
               var marker = new google.maps.Marker({
                  position: latlng,
                  map: map,
                  title: currEntry.name,
               });
            
               bindInfoWindow(marker, map, infowindow, currEntry)
            }
         }
      }

      function bindInfoWindow(marker, map, infowindow, jsonEntry) {
         google.maps.event.addListener(marker, 'click', function () {
            const category = jsonEntry.category;
            const name = jsonEntry.name;
            const description = jsonEntry.description;
            const hours = jsonEntry.hours;
            const phone = jsonEntry.phone;
            const pos = new google.maps.LatLng(jsonEntry.coordinates[1], jsonEntry.coordinates[0]);
            const content = `
               <h2>${name}</h2><p>${description}</p>
               <p><b>Open:</b> ${hours}<br/><b>Phone:</b> ${phone}</p>
            `;

            infowindow.setContent(content);
            infowindow.setPosition(pos);
            infowindow.setOptions({pixelOffset: new google.maps.Size(0, -30)});
            infowindow.open(map);
         });
      }

      function getLatLngByZipcode(zipcode) {
         var geocoder = new google.maps.Geocoder();
         var address = zipcode;
         var latitude;
         var longitude;
         geocoder.geocode({ 'address': 'zipcode '+address }, function (results, status) {
            if (status == google.maps.GeocoderStatus.OK) {
                  latitude = results[0].geometry.location.lat();
                  longitude = results[0].geometry.location.lng();
                  console.log([latitude, longitude]);
            } else {
                  alert("Request failed.")
            }
         });
         
      }
   </script>

<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBC9qoUkWr5lhVeqb8agYWE7Gx5zxTT66c&libraries=geometry,places&callback=initMap">
</script>
</body>

</html>