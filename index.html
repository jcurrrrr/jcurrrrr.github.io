<!DOCTYPE html>
<html>

<head>
  <title>Labor</title>
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
  <meta charset="utf-8">
  <style>
      #map {
         height: 100%;
         width: 100%;
         left: 0%;
         background-color: grey;
      }

      html, body {
         height: 100%;
         margin: 0;
         padding: 0;
      }

    /* TODO: Step 4A1: Make a generic sidebar. */
  </style>
</head>

<body>
  <!-- TODO: Step 4A2: Add a generic sidebar -->

  <!-- Map appears here -->
  <div id="map"></div>

  <script>
      function initMap() {
         // Create the map.
         map = new google.maps.Map(document.getElementById('map'), {
            zoom: 7,
            center: {lat: 52.632469, lng: -1.689423},
         });

         const apiKey = 'AIzaSyBC9qoUkWr5lhVeqb8agYWE7Gx5zxTT66c';
         const infoWindow = new google.maps.InfoWindow();

         // Show the information for a store when its marker is clicked.
         map.data.addListener('click', (event) => {
            const category = event.feature.getProperty('category');
            const name = event.feature.getProperty('name');
            const description = event.feature.getProperty('description');
            const hours = event.feature.getProperty('hours');
            const phone = event.feature.getProperty('phone');
            const position = event.feature.getGeometry().get();
            const content = `
               <h2>${name}</h2><p>${description}</p>
               <p><b>Open:</b> ${hours}<br/><b>Phone:</b> ${phone}</p>
            `;

            infoWindow.setContent(content);
            infoWindow.setPosition(position);
            infoWindow.setOptions({pixelOffset: new google.maps.Size(0, -30)});
            infoWindow.open(map);
         });

         // Initialize variables
         bounds = new google.maps.LatLngBounds();
         currentInfoWindow = infoWindow;
         /* TODO: Step 4A3: Add a generic sidebar */

         // Try HTML5 geolocation
         if (navigator.geolocation) {
         navigator.geolocation.getCurrentPosition(position => {
            pos = {
            lat: position.coords.latitude,
            lng: position.coords.longitude
            };
            map.setCenter(pos);
            bounds.extend(pos);

            infoWindow.setPosition(pos);
            infoWindow.setContent('Location found.');
            infoWindow.open(map);
            map.setCenter(pos);

            /* TODO: Step 3B2, Call the Places Nearby Search */
         }, () => {
            // Browser supports geolocation, but user has denied permission
            handleLocationError(true, infoWindow, map);
         });
         } else {
         // Browser doesn't support geolocation
         handleLocationError(false, infoWindow, map);
         }

         // Load the stores GeoJSON onto the map.
         map.data.loadGeoJson('https://jcurrrrr.github.io/stores.json', {idPropertyName: 'storeid'});
      }

      function handleLocationError(browserHasGeolocation, infoWindow, map) {
         // Set default location to Sydney, Australia
         pos = {lat: 52.632469, lng: -1.689423};
         map.setCenter(pos);

         // Display an InfoWindow at the map center
         infoWindow.setPosition(pos);
         infoWindow.setContent(browserHasGeolocation ?
         'Geolocation permissions denied. Using default location.' :
         'Error: Your browser doesn\'t support geolocation.');
         infoWindow.open(map);
         currentInfoWindow = infoWindow;
      }
   </script>

<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBC9qoUkWr5lhVeqb8agYWE7Gx5zxTT66c&libraries=places&callback=initMap">
</script>
</body>

</html>